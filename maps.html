<!DOCTYPE html>
<html>
  <head>
    <style>
    #parent{
      width: 100%;
      height: 100%;
    }
    #child_1{
      
      height: 90%;
      width: 100%;
    }
    #child_2{
      
      height: 10%;
      width: 100%;
    }
       #map {
        height:608px;
        width: 100%;
        display: inline-block;
       }
       #dash{
        width: 100%;
        height: 25px;
        
       float: left;
        background-color: #009270;
       }
    </style>
  </head>
  <body>
  <div id="parent">
   
    <div id="child_2">
      <div id="dash"> 

      <select id= "state" onChange="makeRequestForState(this)" style="width: 15%;height:25px;margin-left: 2%;">
							<option value="0">State</option>
							<option value="s1">Andaman Nicobar Islands</option>
							<option value="s2">Andhra Pradesh</option>
							<option value="s3">Arunachal Pradesh</option>
							<option value="s4">Assam</option>
							<option value="s5">Bihar</option>
							<option value="s6">Chandigarh</option>
							<option value="s7">Dadra Nagar Haveli</option>
							<option value="s8">Daman Diu</option>
							<option value="s9">Goa</option>
							<option value="s10">Gujarat</option>
							<option value="s11">Haryana</option>
							<option value="s12">Himachal Pradesh</option>
							<option value="s13">Jammu Kashmir</option>
							<option value="s14">Jharkhand</option>
							<option value="s15">Karnataka</option>
							<option value="s16">Kerala</option>
							<option value="s17">Lakshadweep</option>
							<option value="s18">Madhya Pradesh</option>
							<option value="s19">Maharashtra</option>
							<option value="s20">Manipur</option>
							<option value="s21">Meghalaya</option>
							<option value="s22">Mizoram</option>
							<option value="s23">NCT OF Delhi</option>
							<option value="s24">Nagaland</option>
							<option value="s25">Odisha</option>
							<option value="s26">Puducherry</option>
							<option value="s27">Punjab</option>
							<option value="s28">Rajasthan</option>
							<option value="s29">Sikkim</option>
							<option value="s30">Tamil Nadu</option>
							<option value="s31">Tripura</option>
							<option value="s32">Uttar Pradesh</option>
							<option value="s33">Uttarakhand</option>
							<option value="s34">West Bengal</option>

					</select>
			<select id="party" onChange="makeRequestForLead(this)" style="width: 15%;height:25px;margin-left: 2%;">
			<option value="p0">Leading Party</option>
			<option value="p1">Aam Aadmi Party</option>
			<option value="p2">All India Anna Dravida Munnetra Kazhagam</option>
			<option value="p3">All India Majlis-E-Ittehadul Muslimeen</option>
			<option value="p4">All India N.R. Congress</option>
			<option value="p5">All India Trinamool Congress</option>
			<option value="p6">All India United Democratic Front</option>
			<option value="p7">Apna Dal</option>
			<option value="p8">Bharatiya Janata Party</option>
			<option value="p9">Biju Janata Dal</option>
			<option value="p10">Communist Party of India</option>
			<option value="p11">Communist Party of India  (Marxist)</option>
			<option value="p12">Independent</option>
			<option value="p13">Indian National Congress</option>
			<option value="p14">Indian National Lok Dal</option>
			<option value="p15">Indian Union Muslim League</option>
			<option value="p16">Jammu & Kashmir Peoples Democratic Party</option>
			<option value="p17">Janata Dal  (Secular)</option>
			<option value="p18">Janata Dal  (United)</option>
			<option value="p19">Jharkhand Mukti Morcha</option>
			<option value="p20">Kerala Congress  (M)</option>
			<option value="p21">Lok Jan Shakti Party</option>
			<option value="p22">Naga Peoples Front</option>
			<option value="p23">National Peoples Party</option>
			<option value="p24">Nationalist Congress Party</option>
			<option value="p25">Pattali Makkal Katchi</option>
			<option value="p26">Rashtriya Janata Dal</option>
			<option value="p27">Rashtriya Lok Samta Party</option>
			<option value="p28">Revolutionary Socialist Party</option>
			<option value="p29">Samajwadi Party</option>
			<option value="p30">Shiromani Akali Dal</option>
			<option value="p31">Shivsena</option>
			<option value="p32">Sikkim Democratic Front</option>
			<option value="p33">Swabhimani Paksha</option>
			<option value="p34">Telangana Rashtra Samithi</option>
			<option value="p35">Telugu Desam</option>
			<option value="p36">Yuvajana Sramika Rythu Congress Party</option>
			
			
			</select>
					</div>
    </div>
     <div id="child_1">
      <div id="map" ></div>
    </div>
    
  </div>

<script>
		var markers=[];
		var infowindows=[];
      var map=null;
      var state=document.getElementById("state");
      function makeRequestForLead(select){
      		for(i=0;i<markers.length;i++){
      			markers[i].setMap(null);
      		}
      		var ourRequest=new XMLHttpRequest();
			var party_name=select.options[select.selectedIndex].text;
			var url='https://pollingappdjango.herokuapp.com/leadparty?leadparty='+party_name;
			ourRequest.open('GET',url);
			ourRequest.onload=function(){
				var responseData=JSON.parse(ourRequest.responseText);
				for(i=0;i<responseData.length;i++){
					var constituency=responseData[i].constituency;
					var constituency_code=responseData[i].constituency_code;
					var leading_Candidate=responseData[i].Leading_Candidate;
					var margin=responseData[i].Margin;
					var latitude=responseData[i].Latitude;
					var longitude=responseData[i].Longitude;
					var contentString='<div id="content">'+
        		'<div id="siteNotice">'+
        		'</div>'+
        		'<h1 id="firstHeading" class="firstHeading">'+constituency+'</h1><div id="bodyContent">'+
        		'<p>Constituency Code: '+constituency_code+'</br>Leading Candidate: '+leading_Candidate+'</br>Margin :'+margin+'</br></p>'
        		'</div>'
        		'</div>'
        		addMarker(latitude,longitude,contentString,constituency,party_name);
			}

      }
      ourRequest.send();
  }


      
      function makeRequestForState(select){
      	for(i=0;i<markers.length;i++){
      		markers[i].setMap(null);
      	}
			var ourRequest=new XMLHttpRequest();
			var state_name=select.options[select.selectedIndex].text;
			var url='https://pollingappdjango.herokuapp.com/state?state='+state_name;
			ourRequest.open('GET',url);
			ourRequest.onload=function() {
			var responseData=JSON.parse(ourRequest.responseText);
        	for(i=0;i<responseData.length;i++){
        		var consti=responseData[i].constituency;
        		var consti_code=responseData[i].constituency_code;
        		var lead_cand=responseData[i].Leading_Candidate;
        		var lead_party=responseData[i].Leading_Party;
        		var trail_cand=responseData[i].Trailing_Candidate;
        		var trail_party=responseData[i].Trailing_Party;
        		var margin=responseData[i].Margin;
        		var status=responseData[i].Status;
        		var state=responseData[i].State;
        		var state_code=responseData[i].State_Code;
        		var lat=responseData[i].Latitude;
        		var lng=responseData[i].Longitude;
        		var contentString='<div id="content">'+
        		'<div id="siteNotice">'+
        		'</div>'+
        		'<h1 id="firstHeading" class="firstHeading">'+consti+'</h1><div id="bodyContent">'+
        		'<p>Constituency Code: '+consti_code+'</br>Leading Candidate: '+lead_cand+'</br>Leading Party: '+lead_party+'</br>Trailing Candidate: '+trail_cand+'</br>Trailing Party: '+trail_party+'</br>Margin :'+margin+'</br>Status :'+status+'</br>State: '+state+'</br>State Code: '+state_code+'</p>'
        		'</div>'
        		'</div>'
        		addMarker(lat,lng,contentString,consti,lead_party);
        }
      }
      ourRequest.send();
  }
      function init() {
		map = new google.maps.Map(document.getElementById('map'), {
				zoom: 5,
				center: new google.maps.LatLng(20.5937, 78.9629),
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});
			
      }
      function addMarker(lat,lng,content,title,party){
      	map.setCenter(new google.maps.LatLng(lat, lng))
      	map.setZoom(7)
      	var infowindow = new google.maps.InfoWindow({
   			 content: content
  		});
  		var image=null;
  		if(party=='Bharatiya Janata Party'){
  			image='https://pollingappdjango.herokuapp.com/bjp'
  		}
  		else if(party=='Telugu Desam'){
  			image='https://pollingappdjango.herokuapp.com/tdp'
  		}
  		else if(party=='Indian National Congress'){
  			image='https://pollingappdjango.herokuapp.com/cng'
  		}
  		
		  
		var marker = new google.maps.Marker({
				position: new google.maps.LatLng(lat,lng),
				map: map,
				icon:image,
				scaledSize: new google.maps.Size(42, 68),
				animation: google.maps.Animation.DROP,
				title:title,
			});
		marker.addListener('click',function(){
			for(i=0;i<infowindows.length;i++){
				if(infowindows[i]){
					infowindows[i].close();
				}
			}
			infowindow.open(map,marker);
		});
		markers.push(marker);
		infowindows.push(infowindow);
		  
		}
</script>
<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB6_Bgn3QQmdH_uQBKbc_GXsMzObAW9ov4&callback=init">
</script>
  </body>
</html>
